# 全局唯一id
- id不能自增,数据过于明显
- 受单表数据量的限制
**解决方法:redis全局ID生成器**
ID 组成: 符号位(一位)+时间戳(31位)+序列号(32位)
符号位: 固定为0
时间戳: 31位时间戳
序列号: 32位序列号
# 超卖问题
- CAS法
  - 问题:,原来是判定库存是否和原来查询的一致,但在仍然存在库存的情况下,由于另一个线程已经修改了库存,本线程就无法下单
  - 解决方法:只需要判断库存是否大于0即可,如果大于0,则下单,否则返回失败

# 一人一单
- 问题: 由于是多线程,所以会出现一人多单的情况
- 解决方法: 使用悲观锁(synchronized),在查询订单时,对用户id加上锁,防止同一用户的其他线程修改订单
  - 仍然存在问题:在集群部署下,会出现多个节点同时获取锁的情况,导致一人多单的问题
  - 解决方法: 使用redis分布式锁,对用户id加上锁,防止同一用户的其他线程修改订单

  
