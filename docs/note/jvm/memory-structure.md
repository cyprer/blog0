# jvm内存结构

## 运行时数据区
- 线程私有：程序计数器、虚拟机栈、本地方法栈
- 线程共享：堆、方法区
## 堆
  对于hotspot来说,**在jdk1.8之前**,堆实际包含了新生代老年代和方法区,**但在jdk1.8之后**,方法区从堆中移除,使用的是直接内存,实现为元空间
## jdk1.6
  对于hotspot来说,方法区的实现为永久代,包含字符串常量池和运行时常量池
## jdk1.7
  对于hotspot来说,方法区的实现为永久代,方法区的字符串常量池迁移到堆中
## jdk1.8
  方法区的实现为元空间,使用的是直接内存.
## 为什么移除了永久代而使用元空间
  1. 永久代的缺点

  永久代是堆内内存，受-XX:MaxPermSize严格限制，现代框架（Spring/MyBatis）动态生成大量类（动态代理 / CGLIB）+ 字符串常量累积;永久代与新生代、老年代共享堆内存，GC 回收时相互影响，且永久代的 GC 仅在 Full GC 时触发，回收效率极低；
  2. 元空间的优点
    
    内存灵活：元空间是堆外内存，默认仅受操作系统物理内存限制，无需担心固定大小导致的溢出，且支持动态扩容；
    GC 效率高：元空间采用懒加载，仅在类加载时分配内存，类卸载时及时回收元数据，GC 回收与堆 GC 解耦，效率大幅提升；
